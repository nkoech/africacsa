var app=(function(){var a={globalVal:{rcpPrecData45:"",rcpPrecData85:"",rcpTempData45:"",rcpTempData85:"",farmSystemLevelNextData:"",farmSystemPercNextData:"",farmSystemLevelPrevData:"",farmSystemPercPrevData:"",clickTemp:true,clickPrec:true,mapClickEvent:true},initMap:function(){L.mapbox.accessToken="pk.eyJ1IjoiYWZyaWNhY3NhIiwiYSI6InBSaTNVbXMifQ.Hzv8HZqod9eP4QX2joeQBg";map=L.mapbox.map("map",null,{maxZoom:9,minZoom:3}).setView([5.7909,22.5],3)},getMapComponent:function(){layers={admin0:L.mapbox.tileLayer("africacsa.8451ad0f"),admin1:L.mapbox.tileLayer("africacsa.53abf605"),admin2:L.mapbox.tileLayer("africacsa.5893b9a7")};grids={admin0:L.mapbox.gridLayer("africacsa.8451ad0f"),admin1:L.mapbox.gridLayer("africacsa.53abf605"),admin2:L.mapbox.gridLayer("africacsa.5893b9a7")};gridControls={admin0:L.mapbox.gridControl(grids.admin0),admin1:L.mapbox.gridControl(grids.admin1),admin2:L.mapbox.gridControl(grids.admin2)}},resizeMapCanvasHeight:function(){$(window).on("resize",function(){if($(".tabbable").height()>$(window).height()){$(".map-canvas").height($(".tabbable").height()+35)}else{$(".map-canvas").height($(window).height())}map.invalidateSize();$("#map-rcp-chart-container").width(($(window).width()-$(".map-canvas").width())-7)}).trigger("resize")},mapComponent:function(){var b='<p><span style="font-size: 20px;">{{ADM0_NAME}}</span><hr noshade>{{#C_RURALPOP}}<span style="font-size:14px;"><strong>Total Rural Population: </strong></span>{{C_RURALPOP}}<br>{{/C_RURALPOP}}{{#C_NoHSEHLD}}<span style="font-size:14px;"><strong>Total Farming Households: </strong></span>{{C_NoHSEHLD}}<br>{{/C_NoHSEHLD}}<small style="color:#336699">Click map for Emission Scenarios ....</small></p>';layers.admin0.addTo(map);grids.admin0.addTo(map);a.showMapEmissionsScenarioOnClick(grids.admin0);gridControls.admin0.addTo(map);gridControls.admin0.setTemplate(b);map.legendControl.addLegend($("#admin0-legend")[0].innerHTML);a.mapComponentEvent(b)},mapComponentEvent:function(d){var g="admin0-legend";var e="admin2-legend";var f="admin1-legend";var c='<p><span style="font-size:20px">{{ADM0_NAME}}</span><hr noshade> {{#ADM1_NAME}}<span style="font-size:14px;"><strong>Region: </strong></span>{{ADM1_NAME}}<br>{{/ADM1_NAME}}{{#C_RURALPOP}}<span style="font-size:14px;"><strong>Total Rural Population: </strong></span>{{C_RURALPOP}}<br>{{/C_RURALPOP}}{{#C_NoHSEHLD}}<span style="font-size:14px;"><strong>Total Farming Households: </strong></span>{{C_NoHSEHLD}}<br>{{/C_NoHSEHLD}}<small style="color:#336699">Click map for Emission Scenarios ....</small></p>';var b='<p><span style="font-size:20px">{{ADM0_NAME}}</span><hr noshade>{{#ADM2_NAME}}<span style="font-size:14px;"><strong>Region: </strong></span>{{ADM2_NAME}}<br>{{/ADM2_NAME}}{{#C_RURALPOP}}<span style="font-size:14px;"><strong>Total Rural Population: </strong></span>{{C_RURALPOP}}<br>{{/C_RURALPOP}}{{#C_NoHSEHLD}}<span style="font-size:14px;"><strong>Total Farming Households: </strong></span>{{C_NoHSEHLD}}<br>{{/C_NoHSEHLD}}<small style="color:#336699">Click map for Emission Scenarios ....</small></p>';map.on("zoomend",function(){if(map.getZoom()>=5&&map.getZoom()<=7){if(map.hasLayer(layers.admin0)){a.removeMapComponent(g,layers.admin0,gridControls.admin0,grids.admin0);a.addMapComponent(layers.admin1,f,grids.admin1,gridControls.admin1,c)}if(map.hasLayer(layers.admin2)){a.removeMapComponent(e,layers.admin2,gridControls.admin2,grids.admin2);a.addMapComponent(layers.admin1,f,grids.admin1,gridControls.admin1,c)}a.showMapEmissionsScenarioOnClick(grids.admin1)}else{if(map.getZoom()>=8){if(map.hasLayer(layers.admin1)){a.removeMapComponent(f,layers.admin1,gridControls.admin1,grids.admin1);a.addMapComponent(layers.admin2,e,grids.admin2,gridControls.admin2,b)}a.showMapEmissionsScenarioOnClick(grids.admin2)}else{if(map.hasLayer(layers.admin1)){a.removeMapComponent(f,layers.admin1,gridControls.admin1,grids.admin1);a.addMapComponent(layers.admin0,g,grids.admin0,gridControls.admin0,d)}a.showMapEmissionsScenarioOnClick(grids.admin0)}}});map.on("click",function(){a.mapEventRemoveControl()});map.on("mouseout",function(){a.mapEventRemoveControl()});map.on("mousemove",function(){if($(".map-tooltip-content").length==1){if(map.hasLayer(layers.admin0)){gridControls.admin0.addTo(map)}else{if(map.hasLayer(layers.admin1)){gridControls.admin1.addTo(map)}else{gridControls.admin2.addTo(map)}}}})},mapEventRemoveControl:function(){if($(".map-tooltip-content").length==2){if(map.hasLayer(layers.admin0)){map.removeControl(gridControls.admin0)}else{if(map.hasLayer(layers.admin1)){map.removeControl(gridControls.admin1)}else{map.removeControl(gridControls.admin2)}}}},removeMapComponent:function(e,d,b,c){map.legendControl.removeLegend(document.getElementById(e).innerHTML);map.removeLayer(d);map.removeControl(b);map.removeLayer(c)},addMapComponent:function(d,e,c,b,f){d.addTo(map);map.legendControl.addLegend(document.getElementById(e).innerHTML);c.addTo(map);b.addTo(map);b.setTemplate(f)},showMapEmissionsScenarioOnClick:function(b){b.on("click",function(f){var i=f.data;var h="";if(i){if($(".nav-tabs .active").text()=="About"){$('#mapTab a[href="#map-rcp-chart-tab"]').tab("show")}$(".map-rcp-title-bg,.map-rcp-body").remove();a.showMapEmissionsScenarioTitle(i);var g=a.showMapEmissionsScenario(i,"8_","8.5");var c=a.showMapEmissionsScenario(i,"4_","4.5");var j="";var d="";if(map.hasLayer(layers.admin0)){d=window.admin0Data;j=a.showMapFarmSystem(i,d,"ADM0_NAME")}else{if(map.hasLayer(layers.admin1)){d=window.admin1Data;j=a.showMapFarmSystem(i,d,"ADM1_NAME")}else{d=window.admin2Data;j=a.showMapFarmSystem(i,d,"ADM2_NAME")}}h='<div class="map-rcp-body"><div class="row"><div class="tab-pane-rcp-btn"><div class="col-xs-6"><a class="btn btn-large btn-danger btn-md" id="btnTemp" onclick="app.showMapScenarioTempChartOnBtnClick();"><span class="btn-label"> Temperature </span></a></div><div class="col-xs-6"><a class="btn btn-large btn-primary btn-md pull-right" id="btnPrec" onclick="app.showMapScenarioPrecChartOnBtnClick();"><span class="btn-label"> Precipitation </span></a></div></div></div><div class="map-rcp-chart"><div id="map-rcp-chart-container"></div></div></div>';$(".tab-pane-rcp-chart").append(h);$("#map-rcp-chart-container").width(($(window).width()-$(".map-canvas").width())-7);if(a.globalVal.mapClickEvent){a.showMapEmissionsScenarioChart("FUTURE TEMPERATURE CHANGE",g.rcpTempData,c.rcpTempData,"Temperature (°C)","°C");a.globalVal.clickTemp=false;$("#btnTemp").disable(true)}else{a.showMapEmissionsScenarioChart("CHANGE IN PRECIPITATION",g.rcpPrecData,c.rcpPrecData,"Precipitation (%)","%");$("#btnPrec").disable(true)}a.globalVal.rcpTempData45=g.rcpTempData;a.globalVal.rcpTempData85=c.rcpTempData;a.globalVal.rcpPrecData45=g.rcpPrecData;a.globalVal.rcpPrecData85=c.rcpPrecData;if(j.farmSystemLevelNext.length!=0){a.globalVal.farmSystemLevelNextData=j.farmSystemLevelNext;a.globalVal.farmSystemPercNextData=j.farmSystemPercNext;a.globalVal.farmSystemLevelPrevData=j.farmSystemLevelPrev;a.globalVal.farmSystemPercPrevData=j.farmSystemPercPrev;h='<div class="map-rcp-body">'+j.tabPaneHtml+'</tbody></table><nav><ul class="pager"><li class="previous disabled"><a href="#"><span aria-hidden="true">&larr;</span> Previous</a></li><li class="next"><a onclick="app.showMapFarmSystemOnNextClick();">Next <span aria-hidden="true">&rarr;</span></a></li></ul></nav><div class="map-rcp-source"><span>Source: <a href="http://climatewizard.ciat.cgiar.org/" target="_blank">&copy; Climate Wizard 2015 </a></span></div></div></div>';$(".tab-pane-farmsys-tab").append(h)}else{h='<div class="map-rcp-body">'+j.tabPaneHtml+'</tbody></table><div class="map-rcp-source"><span>Source: <a href="http://climatewizard.ciat.cgiar.org/" target="_blank">&copy; Climate Wizard 2015 </a></span></div></div></div>';$(".tab-pane-farmsys-tab").append(h)}}})},showMapEmissionsScenarioTitle:function(c){var b="";if(c.ADM0_NAME!==undefined){b='<div class="map-rcp-title-bg"><p class="map-rcp-country-title">'+c.ADM0_NAME+"</p>"}else{b='<div class="map-rcp-title-bg"><p class="map-rcp-country-title"> No Record </p>'}if(c.ADM1_NAME!==undefined){b+='<p class="map-rcp-region-title"> Region: '+c.ADM1_NAME+"</p></div>"}else{if(c.ADM2_NAME!==undefined){b+='<p class="map-rcp-region-title"> Region: '+c.ADM2_NAME+"</p></div>"}else{b+='<p class="map-rcp-region-title"> Region: No Record </p></div>'}}$(".tab-pane-rcp-chart").append(b);$(".tab-pane-farmsys-tab").append(b)},showMapEmissionsScenario:function(g,e,c){var d=[];var f=[];for(var b in g){if(g.hasOwnProperty(b)){if(b!=="No_HSEHOLD"&&b!=="RURAL_POP"){if(b.indexOf(e)!==-1){if(b.indexOf("AV_TMP")!==-1){if(b.indexOf("_30")!==-1){d.push(g[b])}else{if(b.indexOf("_50")!==-1){d.push(g[b])}else{d.push(g[b])}}}else{if(b.indexOf("_30")!==-1){f.push(+g[b])}else{if(b.indexOf("_50")!==-1){f.push(+g[b])}else{f.push(+g[b])}}}}}}}return{rcpTempData:d,rcpPrecData:f}},showMapFarmSystem:function(n,d,h){var j=0;var k=0;var b="";var g=[];var o=[];var c=[];var l=[];for(var m in n){if(n.hasOwnProperty(m)){if(m.indexOf("ADM")!==-1){if(j<1){b+='<p class="map-rcp-emission-title">Farming Sub-systems</p><div class="map-farmsys-body"><table class="table table-condensed table-striped"><tbody>'}for(var f=0;f<d.profile.length;f++){var e=d.profile[f];if(e.hasOwnProperty("country")&&e.hasOwnProperty("region")&&e.hasOwnProperty("level_2")){if(a.replaceSpecialChar(n.ADM0_NAME)==a.replaceSpecialChar(e.country.toString())){if(a.replaceSpecialChar(n[m])==a.replaceSpecialChar(e.region.toString())){k+=1;if(m==h){if(k<10){b+='<tr><td class="map-rcp-year-data">'+e.level_2.toString()+'<span class="map-frm-perc-data"> '+e.level_perc.toString()+"%</span></td></tr>";c.push(e.level_2.toString());l.push(e.level_perc.toString())}else{g.push(e.level_2.toString());o.push(e.level_perc.toString())}}}}}}j+=1}}}return{tabPaneHtml:b,farmSystemLevelNext:g,farmSystemPercNext:o,farmSystemLevelPrev:c,farmSystemPercPrev:l}},replaceSpecialChar:function(b){return b.replace(/[^a-zA-Z ]/g,"")},showMapFarmSystemOnNextClick:function(){var b=true;a.showMapFarmSystemPagination(a.globalVal.farmSystemLevelNextData,a.globalVal.farmSystemPercNextData,b)},showMapFarmSystemOnPrevClick:function(){var b=false;a.showMapFarmSystemPagination(a.globalVal.farmSystemLevelPrevData,a.globalVal.farmSystemPercPrevData,b)},showMapFarmSystemPagination:function(c,e,b){$(".tab-pane-farmsys-tab .map-rcp-body").remove();var f='<div class="map-rcp-body"><p class="map-rcp-emission-title">Farming Sub-systems</p><div class="map-farmsys-body"><table class="table table-condensed table-striped"><tbody>';for(var d=0;d<c.length;d++){f+='<tr><td class="map-rcp-year-data">'+c[d]+'<span class="map-frm-perc-data"> '+e[d]+"%</span></td></tr>"}if(b){f+='</tbody></table><nav><ul class="pager"><li class="previous"><a onclick="app.showMapFarmSystemOnPrevClick();"><span aria-hidden="true">&larr;</span> Previous</a></li><li class="next disabled"><a href="#">Next <span aria-hidden="true">&rarr;</span></a></li></ul></nav><div class="map-rcp-source"><span>Source: <a href="http://climatewizard.ciat.cgiar.org/" target="_blank">&copy; Climate Wizard 2015 </a></span></div></div></div>'}else{f+='</tbody></table><nav><ul class="pager"><li class="previous disabled"><a href="#"><span aria-hidden="true">&larr;</span> Previous</a></li><li class="next"><a onclick="app.showMapFarmSystemOnNextClick();">Next <span aria-hidden="true">&rarr;</span></a></li></ul></nav><div class="map-rcp-source"><span>Source: <a href="http://climatewizard.ciat.cgiar.org/" target="_blank">&copy; Climate Wizard 2015 </a></span></div></div></div>'}$(".tab-pane-farmsys-tab").append(f)},showMapEmissionsScenarioChart:function(g,b,e,d,f){var c=new Highcharts.Chart({chart:{type:"column",renderTo:"map-rcp-chart-container"},colors:["#5cb85c","#f0ad4e"],title:{text:g,style:{fontSize:"14px"}},subtitle:{useHTML:true,text:'<div class="chart-rcp-source"><span>Source: <a href="http://climatewizard.ciat.cgiar.org/" target="_blank">© Climate Wizard 2015</a></span></div>'},xAxis:{categories:["2030","2050","2080"]},yAxis:{title:{text:d}},credits:{enabled:false},tooltip:{valueSuffix:f},series:[{name:"RCP-4.5",data:e},{name:"RCP-8.5",data:b}]})},showMapScenarioTempChartOnBtnClick:function(){if(a.globalVal.clickTemp){a.showMapEmissionsScenarioChart("FUTURE TEMPERATURE CHANGE",a.globalVal.rcpTempData85,a.globalVal.rcpTempData45,"Temperature (°C)","°C")}a.globalVal.clickTemp=false;a.globalVal.clickPrec=true;a.globalVal.mapClickEvent=true;$("#btnPrec").disable(false);$("#btnTemp").disable(true)},showMapScenarioPrecChartOnBtnClick:function(){if(a.globalVal.clickPrec){a.showMapEmissionsScenarioChart("CHANGE IN PRECIPITATION",a.globalVal.rcpPrecData85,a.globalVal.rcpPrecData45,"Precipitation (%)","%")}a.globalVal.clickTemp=true;a.globalVal.clickPrec=false;a.globalVal.mapClickEvent=false;$("#btnTemp").disable(false);$("#btnPrec").disable(true)},extendJQueryProto:function(){jQuery.fn.extend({disable:function(b){return this.each(function(){var c=$(this);c.toggleClass("disabled",b)})}})}};return a})();app.initMap();app.getMapComponent();app.resizeMapCanvasHeight();app.mapComponent();app.extendJQueryProto();