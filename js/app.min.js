var app=(function(){var a={globalVal:{rcpPrecData45:"",rcpPrecData85:"",rcpTempData45:"",rcpTempData85:"",clickTemp:true,clickPrec:true,mapClickEvent:true},initMap:function(){L.mapbox.accessToken="pk.eyJ1IjoiYWZyaWNhY3NhIiwiYSI6InBSaTNVbXMifQ.Hzv8HZqod9eP4QX2joeQBg";map=L.mapbox.map("map",null,{maxZoom:9,minZoom:3}).setView([5.7909,22.5],3)},getMapComponent:function(){layers={admin0:L.mapbox.tileLayer("africacsa.8451ad0f"),admin1:L.mapbox.tileLayer("africacsa.53abf605"),admin2:L.mapbox.tileLayer("africacsa.5893b9a7")};grids={admin0:L.mapbox.gridLayer("africacsa.8451ad0f"),admin1:L.mapbox.gridLayer("africacsa.53abf605"),admin2:L.mapbox.gridLayer("africacsa.5893b9a7")};gridControls={admin0:L.mapbox.gridControl(grids.admin0),admin1:L.mapbox.gridControl(grids.admin1),admin2:L.mapbox.gridControl(grids.admin2)}},resizeMapCanvasHeight:function(){$(window).on("resize",function(){if($(".tabbable").height()>$(window).height()){$(".map-canvas").height($(".tabbable").height()+35)}else{$(".map-canvas").height($(window).height())}map.invalidateSize();$("#map-rcp-chart-container").width(($(window).width()-$(".map-canvas").width())-7)}).trigger("resize")},mapComponent:function(){var b='<p><span style="font-size: 20px;">{{ADM0_NAME}}</span><hr noshade>{{#C_RURALPOP}}<span style="font-size:14px;"><strong>Total Rural Population: </strong></span>{{C_RURALPOP}}<br>{{/C_RURALPOP}}{{#C_NoHSEHLD}}<span style="font-size:14px;"><strong>Total Farming Households: </strong></span>{{C_NoHSEHLD}}<br>{{/C_NoHSEHLD}}<small style="color:#336699">Click map for Emission Scenarios ....</small></p>';layers.admin0.addTo(map);grids.admin0.addTo(map);a.showMapEmissionsScenarioOnClick(grids.admin0);gridControls.admin0.addTo(map);gridControls.admin0.setTemplate(b);map.legendControl.addLegend($("#admin0-legend")[0].innerHTML);a.mapComponentEvent(b)},mapComponentEvent:function(d){var g="admin0-legend";var e="admin2-legend";var f="admin1-legend";var c='<p><span style="font-size:20px">{{ADM0_NAME}}</span><hr noshade> {{#ADM1_NAME}}<span style="font-size:14px;"><strong>Region: </strong></span>{{ADM1_NAME}}<br>{{/ADM1_NAME}}{{#C_RURALPOP}}<span style="font-size:14px;"><strong>Total Rural Population: </strong></span>{{C_RURALPOP}}<br>{{/C_RURALPOP}}{{#C_NoHSEHLD}}<span style="font-size:14px;"><strong>Total Farming Households: </strong></span>{{C_NoHSEHLD}}<br>{{/C_NoHSEHLD}}<small style="color:#336699">Click map for Emission Scenarios ....</small></p>';var b='<p><span style="font-size:20px">{{ADM0_NAME}}</span><hr noshade>{{#ADM2_NAME}}<span style="font-size:14px;"><strong>Region: </strong></span>{{ADM2_NAME}}<br>{{/ADM2_NAME}}{{#C_RURALPOP}}<span style="font-size:14px;"><strong>Total Rural Population: </strong></span>{{C_RURALPOP}}<br>{{/C_RURALPOP}}{{#C_NoHSEHLD}}<span style="font-size:14px;"><strong>Total Farming Households: </strong></span>{{C_NoHSEHLD}}<br>{{/C_NoHSEHLD}}<small style="color:#336699">Click map for Emission Scenarios ....</small></p>';map.on("zoomend",function(){if(map.getZoom()>=5&&map.getZoom()<=7){if(map.hasLayer(layers.admin0)){a.removeMapComponent(g,layers.admin0,gridControls.admin0,grids.admin0);a.addMapComponent(layers.admin1,f,grids.admin1,gridControls.admin1,c)}if(map.hasLayer(layers.admin2)){a.removeMapComponent(e,layers.admin2,gridControls.admin2,grids.admin2);a.addMapComponent(layers.admin1,f,grids.admin1,gridControls.admin1,c)}a.showMapEmissionsScenarioOnClick(grids.admin1)}else{if(map.getZoom()>=8){if(map.hasLayer(layers.admin1)){a.removeMapComponent(f,layers.admin1,gridControls.admin1,grids.admin1);a.addMapComponent(layers.admin2,e,grids.admin2,gridControls.admin2,b)}a.showMapEmissionsScenarioOnClick(grids.admin2)}else{if(map.hasLayer(layers.admin1)){a.removeMapComponent(f,layers.admin1,gridControls.admin1,grids.admin1);a.addMapComponent(layers.admin0,g,grids.admin0,gridControls.admin0,d)}a.showMapEmissionsScenarioOnClick(grids.admin0)}}});map.on("click",function(){a.mapEventRemoveControl()});map.on("mouseout",function(){a.mapEventRemoveControl()});map.on("mousemove",function(){if($(".map-tooltip-content").length==1){if(map.hasLayer(layers.admin0)){gridControls.admin0.addTo(map)}else{if(map.hasLayer(layers.admin1)){gridControls.admin1.addTo(map)}else{gridControls.admin2.addTo(map)}}}})},mapEventRemoveControl:function(){if($(".map-tooltip-content").length==2){if(map.hasLayer(layers.admin0)){map.removeControl(gridControls.admin0)}else{if(map.hasLayer(layers.admin1)){map.removeControl(gridControls.admin1)}else{map.removeControl(gridControls.admin2)}}}},removeMapComponent:function(e,d,b,c){map.legendControl.removeLegend(document.getElementById(e).innerHTML);map.removeLayer(d);map.removeControl(b);map.removeLayer(c)},addMapComponent:function(d,e,c,b,f){d.addTo(map);map.legendControl.addLegend(document.getElementById(e).innerHTML);c.addTo(map);b.addTo(map);b.setTemplate(f)},showMapEmissionsScenarioOnClick:function(b){b.on("click",function(d){var h=d.data;var g="";if(h){if($(".nav-tabs .active").text()=="About"){$('#mapTab a[href="#map-rcp-chart-tab"]').tab("show")}$(".map-rcp-title-bg,.map-rcp-body").remove();a.showMapEmissionsScenarioTitle(h);var f=a.showMapEmissionsScenario(h,"8_","8.5");var c=a.showMapEmissionsScenario(h,"4_","4.5");g='<div class="map-rcp-body"><div class="row"><div class="tab-pane-rcp-btn"><div class="col-xs-6"><a class="btn btn-large btn-danger btn-md" id="btnTemp" onclick="app.showMapScenarioTempChartOnBtnClick();"><span class="btn-label"> Temperature </span><!--<span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>--></a></div><div class="col-xs-6"><a class="btn btn-large btn-primary btn-md pull-right" id="btnPrec" onclick="app.showMapScenarioPrecChartOnBtnClick();"><span class="btn-label"> Precipitation </span><!--<span class="glyphicon glyphicon-chevron-down" aria-hidden="true"></span>--></a></div></div></div><div class="map-rcp-chart"><div id="map-rcp-chart-container"></div></div></div>';$(".tab-pane-rcp-chart").append(g);$("#map-rcp-chart-container").width(($(window).width()-$(".map-canvas").width())-7);if(a.globalVal.mapClickEvent){a.showMapEmissionsScenarioChart("FUTURE TEMPERATURE CHANGE",f.rcpTempData,c.rcpTempData,"Temperature (°C)","°C");a.globalVal.clickTemp=false}else{a.showMapEmissionsScenarioChart("CHANGE IN PRECIPITATION",f.rcpPrecData,c.rcpPrecData,"Precipitation (%)","%")}a.globalVal.rcpTempData45=f.rcpTempData;a.globalVal.rcpTempData85=c.rcpTempData;a.globalVal.rcpPrecData45=f.rcpPrecData;a.globalVal.rcpPrecData85=c.rcpPrecData;g='<div class="map-rcp-body">'+f.tabPaneHtml+c.tabPaneHtml+'<div class="map-rcp-source"><span>Source: <a href="http://climatewizard.ciat.cgiar.org/" target="_blank">&copy; Climate Wizard 2015 </a></span></div></div>';$(".tab-pane-rcp").append(g)}})},showMapEmissionsScenarioTitle:function(c){var b="";if(c.ADM0_NAME!==undefined){b='<div class="map-rcp-title-bg"><p class="map-rcp-country-title">'+c.ADM0_NAME+"</p>"}else{b='<div class="map-rcp-title-bg"><p class="map-rcp-country-title"> No Record </p>'}if(c.ADM1_NAME!==undefined){b+='<p class="map-rcp-region-title"> Region: '+c.ADM1_NAME+"</p></div>"}else{if(c.ADM2_NAME!==undefined){b+='<p class="map-rcp-region-title"> Region: '+c.ADM2_NAME+"</p></div>"}else{b+='<p class="map-rcp-region-title"> Region: No Record </p></div>'}}$(".tab-pane-rcp").append(b);$(".tab-pane-rcp-chart").append(b)},showMapEmissionsScenario:function(j,i,c){var e=0;var f=0;var b="";var d=[];var h=[];for(var g in j){if(j.hasOwnProperty(g)){if(g!=="No_HSEHOLD"&&g!=="RURAL_POP"){if(g.indexOf(i)!==-1){if(e<1){b+='<p class="map-rcp-emission-title">Emission Scenario '+c+"</p>";b+='<p class="map-rcp-emission-subtitle">Future Temperature Change</p>'}if(g.indexOf("AV_TMP")!==-1){if(g.indexOf("_30")!==-1){b+='<p class="map-rcp"><span class="map-rcp-year-label">2030: </span><span class="map-rcp-year-data">'+j[g]+"&deg;C</span></p>";d.push(j[g])}else{if(g.indexOf("_50")!==-1){b+='<p class="map-rcp"><span class="map-rcp-year-label">2050: </span><span class="map-rcp-year-data">'+j[g]+"&deg;C</span></p>";d.push(j[g])}else{b+='<p class="map-rcp"><span class="map-rcp-year-label">2080: </span><span class="map-rcp-year-data">'+j[g]+"&deg;C</span></p>";d.push(j[g])}}}else{if(f<1){b+='<p class="map-rcp-emission-subtitle">Change in Precipitation</p>'}if(g.indexOf("_30")!==-1){b+='<p class="map-rcp"><span class="map-rcp-year-label">2030: </span></span><span class="map-rcp-year-data">'+j[g]+"</span></p>";h.push(+j[g].substring(0,j[g].length-1))}else{if(g.indexOf("_50")!==-1){b+='<p class="map-rcp"><span class="map-rcp-year-label">2050: </span></span><span class="map-rcp-year-data">'+j[g]+"</span></p>";h.push(+j[g].substring(0,j[g].length-1))}else{b+='<p class="map-rcp"><span class="map-rcp-year-label">2080: </span></span><span class="map-rcp-year-data">'+j[g]+"</span></p>";h.push(+j[g].substring(0,j[g].length-1))}}f+=1}e+=1}}}}return{tabPaneHtml:b,rcpTempData:d,rcpPrecData:h}},showMapEmissionsScenarioChart:function(g,b,e,d,f){var c=new Highcharts.Chart({chart:{type:"column",renderTo:"map-rcp-chart-container"},colors:["#f0ad4e","#5cb85c"],title:{text:g,style:{fontSize:"14px"}},subtitle:{useHTML:true,text:'<div class="chart-rcp-source"><span>Source: <a href="http://climatewizard.ciat.cgiar.org/" target="_blank">© Climate Wizard 2015</a></span></div>'},xAxis:{categories:["2030","2050","2080"]},yAxis:{title:{text:d}},credits:{enabled:false},tooltip:{valueSuffix:f},series:[{name:"RCP-4.5",data:e},{name:"RCP-8.5",data:b}]})},showMapScenarioTempChartOnBtnClick:function(){if(a.globalVal.clickTemp){a.showMapEmissionsScenarioChart("FUTURE TEMPERATURE CHANGE",a.globalVal.rcpTempData85,a.globalVal.rcpTempData45,"Temperature (°C)","°C")}a.globalVal.clickTemp=false;a.globalVal.clickPrec=true;a.globalVal.mapClickEvent=true},showMapScenarioPrecChartOnBtnClick:function(){if(a.globalVal.clickPrec){a.showMapEmissionsScenarioChart("CHANGE IN PRECIPITATION",a.globalVal.rcpPrecData85,a.globalVal.rcpPrecData45,"Precipitation (%)","%")}a.globalVal.clickTemp=true;a.globalVal.clickPrec=false;a.globalVal.mapClickEvent=false}};return a})();app.initMap();app.getMapComponent();app.resizeMapCanvasHeight();app.mapComponent();